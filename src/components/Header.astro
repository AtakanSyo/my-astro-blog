---
interface Props {
  lang?: 'en' | 'tr';
  currentPath?: string;
}

import logoUrl from '../assets/images/shared/logo.svg?url';

const { lang = 'en', currentPath = '' } = Astro.props as Props;
const isTr = lang === 'tr';

// base prefix for URLs ('' or '/tr')
const base = isTr ? '/tr' : '';

// localized labels
const labels = {
  home:       isTr ? 'Ana Sayfa'   : 'Home',
  telescopes: isTr ? 'Teleskoplar' : 'Telescopes',
  authors:    isTr ? 'Yazarlar'    : 'Authors',
  about:      isTr ? 'HakkÄ±nda'    : 'About',
  searchPlaceholder: isTr ? 'Araâ€¦' : 'Searchâ€¦',
  searchAria:        isTr ? 'YazÄ±larda ara' : 'Search posts',
  menuToggleAria:    isTr ? 'MenÃ¼yÃ¼ aÃ§ / kapa' : 'Toggle menu',
  searchToggleAria:  isTr ? 'AramayÄ± aÃ§' : 'Open search',
  searchCloseAria:   isTr ? 'AramayÄ± kapat' : 'Close search',
};

// site name: use Astro.site or fallback
const siteName =
  Astro.site?.hostname ?? 'Astrosyo';

function normalizePath(path: string) {
  if (!path) return '/';
  const withoutQuery = path.split('?')[0]?.split('#')[0] ?? path;
  return withoutQuery.length > 1 ? withoutQuery.replace(/\/+$/, '') : withoutQuery;
}

function isCurrent(href: string) {
  return normalizePath(currentPath) === normalizePath(href);
}
---

<header>
  <div class="header-inner">
    <a href={base + '/'} class="logo centered_flex" aria-label={labels.home}>
      <img src={logoUrl} alt={siteName} />
    </a>

    <button
      class="nav-toggle"
      type="button"
      aria-label={labels.menuToggleAria}
      aria-controls="site-nav"
      aria-expanded="false"
    >
      <span class="hamburger"></span>
    </button>

    <nav class="site-nav" id="site-nav">
      <a
        href={base + '/'}
        class="nav-item"
        aria-current={isCurrent(base + '/') ? 'page' : undefined}
      >
        {labels.home}
      </a>
      <a
        href={base + '/telescopes'}
        class="nav-item"
        aria-current={isCurrent(base + '/telescopes') ? 'page' : undefined}
      >
        {labels.telescopes}
      </a>
      <a
        href={base + '/authors'}
        class="nav-item"
        aria-current={isCurrent(base + '/authors') ? 'page' : undefined}
      >
        {labels.authors}
      </a>
      <a
        href={base + '/about'}
        class="nav-item"
        aria-current={isCurrent(base + '/about') ? 'page' : undefined}
      >
        {labels.about}
      </a>

      <button
        class="nav-search-toggle"
        aria-label={labels.searchToggleAria}
        type="button"
      >
        ðŸ”Ž
      </button>

      <form action={base + '/search'} method="get" class="nav-search-form">
        <input
          type="search"
          name="q"
          class="nav-search-input"
          placeholder={labels.searchPlaceholder}
          aria-label={labels.searchAria}
        />
        <button
          type="button"
          class="nav-search-close"
          aria-label={labels.searchCloseAria}
        >
          âœ•
        </button>
      </form>
    </nav>
  </div>
</header>
