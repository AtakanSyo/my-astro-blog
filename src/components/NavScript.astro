---
// no props needed
---
<script is:inline>
  (() => {
    // Avoid double-install (Astro view transitions / partial reloads, etc.)
    if (window.__navScriptInstalled) return;
    window.__navScriptInstalled = true;

    const init = () => {
      const nav = document.querySelector('.site-nav');
      const menuToggle = document.querySelector('.nav-toggle');
      const searchToggle = document.querySelector('.nav-search-toggle');
      const searchForm = document.querySelector('.nav-search-form');
      const searchClose = document.querySelector('.nav-search-close');
      const searchInput = searchForm?.querySelector('input');

      if (!nav || !menuToggle) return;

      const setMenuExpanded = (expanded) => {
        menuToggle.setAttribute('aria-expanded', String(Boolean(expanded)));
      };

      setMenuExpanded(nav.classList.contains('open'));

      menuToggle.addEventListener('click', () => {
        const isOpen = nav.classList.toggle('open');
        menuToggle.classList.toggle('active', isOpen);
        setMenuExpanded(isOpen);
        // always hide search if you open/close the menu
        nav.classList.remove('search-open');
      });

      searchToggle?.addEventListener('click', () => {
        nav.classList.add('search-open');
        searchInput?.focus();
      });

      searchClose?.addEventListener('click', () => {
        nav.classList.remove('search-open');
        searchToggle?.focus?.();
      });

      document.addEventListener('keydown', (e) => {
        if (e.key !== 'Escape') return;
        nav.classList.remove('search-open');
        if (nav.classList.contains('open')) {
          nav.classList.remove('open');
          menuToggle.classList.remove('active');
          setMenuExpanded(false);
        }
      });
    };

    init();
    document.addEventListener('astro:page-load', init);
  })();
</script>
