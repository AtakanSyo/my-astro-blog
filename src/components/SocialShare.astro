---
import { site } from '../config/site.js';
import { Icon } from 'astro-icon/components';
const { url, frontmatter } = Astro.props;
// full URL of this post
const fullUrl = site.url + url;
// URL-encode once for re-use
const eUrl = encodeURIComponent(fullUrl);
const eTitle = encodeURIComponent(frontmatter.title);
const toastText = frontmatter?.lang === 'tr' ? 'Bağlantı kopyalandı!' : 'Link copied!';
---

<!-- Container with relative positioning for toast placement -->
<div class="social-share-container">
  <div class="social-share">
    <a
      class="social-btn"
      href={`https://www.facebook.com/sharer.php?u=${eUrl}`}
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Share on Facebook"
      title="Share on Facebook"
    >
        <Icon name="fa6-brands:facebook-f" width="20" height="20" aria-hidden="true" />

    </a>

    <a
      class="social-btn"
      href={`https://twitter.com/intent/tweet?url=${eUrl}&text=${eTitle}`}
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Share on Twitter"
      title="Share on Twitter"
    >
      <Icon name="logos:twitter" width="20" height="20" aria-hidden="true" />
    </a>

    <a
      class="social-btn"
      href={`https://wa.me/?text=${eTitle}%20${eUrl}`}
      target="_blank"
      rel="noopener noreferrer"
      aria-label="Share on WhatsApp"
      title="Share on WhatsApp"
    >
      <Icon name="ion:logo-whatsapp" width="20" height="20" aria-hidden="true" />
    </a>

    <button
      class="social-btn"
      data-url={fullUrl}
      data-copy-btn
      type="button"
      aria-label="Copy post link"
      title="Copy post link"
    >
      <Icon name="bi:link-45deg" width="20" height="20" aria-hidden="true" />
    </button>
  </div>

  <!-- Non-intrusive toast notification, positioned relative to the container -->
  <div class="copy-toast" role="status" aria-live="polite" aria-atomic="true" hidden>
    {toastText}
  </div>
</div>

<!-- Client-side logic to handle copy and show toast -->
<script is:inline>
  (() => {
    const root = document.currentScript?.closest('.social-share-container');
    if (!root) return;

    const copyBtn = root.querySelector('[data-copy-btn]');
    const toast = root.querySelector('.copy-toast');
    const fullUrl = copyBtn?.dataset?.url;
    if (!copyBtn || !toast || !fullUrl) return;

    const showToast = () => {
      // Position toast next to button
      const rect = copyBtn.getBoundingClientRect();
      const containerRect = root.getBoundingClientRect();
      const top = rect.bottom - containerRect.top + 8; // 8px below
      const left = rect.right - containerRect.left - toast.offsetWidth;
      toast.style.top = `${top}px`;
      toast.style.left = `${left}px`;

      toast.hidden = false;
      toast.classList.add('visible');
      setTimeout(() => {
        toast.classList.remove('visible');
        toast.hidden = true;
      }, 1000);
    };

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(fullUrl);
      } catch {
        window.prompt('Copy link:', fullUrl);
      }
      showToast();
    });
  })();
</script>
