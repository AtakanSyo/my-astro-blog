---
import Layout from '../layouts/Layout.astro';

// Grab every .md and .mdx file in src/pages/posts/
const posts = await Astro.glob('./posts/*.{md,mdx}', { eager: true });

// Optional: sort by date descending
posts.sort((a, b) => new Date(b.frontmatter.pubDate) - new Date(a.frontmatter.pubDate));
---

<Layout title="All Posts">
  <section class="container centered_flex">
    <h1>All Posts</h1>
    {posts.length === 0 ? (
      <p>No posts foundâ€”stay tuned!</p>
    ) : (
      <ul class="post-list">
        {posts.map(({ frontmatter, url }) => (
          <li class="post-item" key={url}>
            <a href={url}>
              {frontmatter.image && (
                <img
                  src={frontmatter.image}
                  alt={frontmatter.title}
                  class="post-cover"
                />
              )}
              <h2>{frontmatter.title}</h2>
              <time datetime={frontmatter.pubDate}>
                {new Date(frontmatter.pubDate).toLocaleDateString('en-GB', {
                  year: 'numeric',
                  month: 'short',
                  day: 'numeric'
                })}
              </time>
              <p>{frontmatter.description}</p>
            </a>
          </li>
        ))}
      </ul>
    )}
  </section>
</Layout>