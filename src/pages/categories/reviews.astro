---
import Layout from '../../layouts/Layout.astro';

const category = Astro.params.category; // “reviews”, “astronomy”, …
const allPosts = await Astro.glob('../posts/*.{md,mdx}', { eager: true });

// Filter by frontmatter.category
const posts = allPosts.filter(p => p.frontmatter.category === category);

// If no such category, show 404 (optional)
if (posts.length === 0) {
  throw new Error(`No posts found in category "${category}"`);
}
---

<Layout title={`Category: ${category}`}>
  <h1>Category: {category}</h1>
  <div class="post-list">
    {posts.map(({ frontmatter, url }) => (
      <a href={url} class="post_link" key={url}>
        <img src={frontmatter.image} alt={frontmatter.title} class="small_thumbnail" />
        <div>
          <h2>{frontmatter.title}</h2>
          <time datetime={frontmatter.pubDate}>{frontmatter.pubDate}</time>
          <p>{frontmatter.description}</p>
        </div>
      </a>
    ))}
  </div>
</Layout>