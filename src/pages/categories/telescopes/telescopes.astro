---
import Layout from '../../../layouts/Layout.astro';

const { category, subcategory } = Astro.params;
// Grab all posts (including MDX)
const allPosts = await Astro.glob('../../posts/*.{md,mdx}', { eager: true });

// Filter by both fields
const posts = allPosts.filter(
  (p) =>
    p.frontmatter.category === category &&
    p.frontmatter.subcategory === subcategory
);

// 404 if none found
if (posts.length === 0) {
  throw new Error(`No posts in ${category} > ${subcategory}`);
}
---

<Layout title={`Category: ${category} â€º ${subcategory}`}>
  <h1>
    {category.charAt(0).toUpperCase() + category.slice(1)} &gt;{' '}
    {subcategory.charAt(0).toUpperCase() + subcategory.slice(1)}
  </h1>

  <div class="post-list">
    {posts.map(({ frontmatter, url }) => (
      <a href={url} class="post_link" key={url}>
        <img
          src={frontmatter.image}
          alt={frontmatter.title}
          class="small_thumbnail"
        />
        <div>
          <h2>{frontmatter.title}</h2>
          <time datetime={frontmatter.pubDate}>
            {frontmatter.pubDate}
          </time>
          <p>{frontmatter.description}</p>
        </div>
      </a>
    ))}
  </div>
</Layout>