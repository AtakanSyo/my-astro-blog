---
import Layout from '../../../layouts/Layout.astro';
import '../../../styles/index.css';
import '../../../styles/cards.css';
import '../../../styles/category.css';
import FloatingIcons from "../../../components/FloatingIcons.astro";
import PostCard from "../../../components/postCard.astro";

export async function getStaticPaths() {
  const all = await Astro.glob('../../tr/posts/*.{md,mdx}', { eager: true });
  const set = new Set();
  for (const p of all) {
    const c = p.frontmatter?.category;
    if (typeof c === 'string' && c) set.add(c.toLowerCase());
  }
  return Array.from(set).map((slug) => ({ params: { slug } }));
}

const slug = (Astro.params.slug || '').toLowerCase();

const labelMap = {
  reviews: 'Teleskop ve Ekipman İncelemeleri',
  nasa: 'NASA Yazıları',
  informational: 'Astronomi Rehberleri ve Bilgiler',
  simulation: 'Astrofizik Simülasyonları',
};
const categoryLabel = labelMap[slug] || `${slug.charAt(0).toUpperCase() + slug.slice(1)} Yazıları`;

const posts = (await Astro.glob('../../tr/posts/*.{md,mdx}', { eager: true }))
  .filter((p) => typeof p.frontmatter?.category === 'string' && p.frontmatter.category.toLowerCase() === slug)
  .sort((a, b) => new Date(b.frontmatter.pubDate) - new Date(a.frontmatter.pubDate));

const count = posts.length;
const countText =
  slug === 'simulation'
    ? `${count} ${count === 1 ? 'simülasyonumuzu' : 'simülasyonumuzu'} keşfedin.`
    : slug === 'reviews'
    ? `${count} ${count === 1 ? 'incelememize' : 'incelememize'} göz atın.`
    : slug === 'informational'
    ? `${count} ${count === 1 ? 'rehber yazımızı' : 'rehber yazımızı'} inceleyin.`
    : slug === 'nasa'
    ? `${count} NASA ${count === 1 ? 'yazımıza' : 'yazımıza'} göz atın.`
    : `${count} ${count === 1 ? 'yazımıza' : 'yazımıza'} göz atın.`;
---

<Layout title="Kategori">

  {slug === "reviews" && (
      <FloatingIcons
      file="telescope-icons"
      />
  )}
  {slug === "nasa" && (
      <FloatingIcons
      file="nasa-icons"
      />
  )}
  {slug === "simulation" && (
      <FloatingIcons
      file="simulation-icons"
      />
  )}
  {slug === "informational" && (
      <FloatingIcons
      file="informational-icons"
      />
  )}


  <h1 class="category-title">{categoryLabel}</h1>
  <p class="category-count-text centered_flex">{countText}</p>

  <div class="category-grid">
    {posts.length === 0 ? (
      <p>No posts.</p>
    ) : (
      posts.map(({ frontmatter, url }) => {
        const cat = frontmatter.category?.toLowerCase();
        const isP5 = cat === 'simulation';
        const isReview = cat === 'reviews';
        const isInfo = cat === 'informational';
        const isNasa = cat === 'nasa';

        const ctaText =
          isP5
            ? 'Simülasyona git →'
          : isReview
            ? 'İncelemeyi oku →'
          : isInfo
            ? 'Rehberi oku →'
          : isNasa
            ? 'Yazıyı gör →'
          : 'Yazının tamamını oku →';

        return (
          <PostCard
            url={url}
            frontmatter={frontmatter}
            isP5={isP5}
            isReview={isReview}
            isInfo={isInfo}
            isNasa={isNasa}
            ctaText={ctaText}
            dateText={new Date(frontmatter.pubDate).toLocaleDateString('tr-TR')}
          />
        );
      })
    )}
  </div>
</Layout>
