---
// imports stay the same
import Layout from '../../layouts/Layout.astro';
import '../../styles/index.css';
import '../../styles/cards.css';
import '../../styles/search.css';
import { site } from '../../config/site.js';
import { Instagram, Youtube } from "lucide-react";
import fs from 'fs/promises';

// 1) load and sort all posts
const allPosts = await Astro.glob('./posts/*.{md,mdx}', { eager: true });
allPosts.sort((a, b) => new Date(b.frontmatter.pubDate) - new Date(a.frontmatter.pubDate));

// helpers
function normalizeCat(cat) {
  if (!cat) return [];
  if (Array.isArray(cat)) return cat.filter(Boolean).map((c) => String(c).toLowerCase());
  return [String(cat).toLowerCase()];
}
function hasCat(frontmatter, needle) {
  return normalizeCat(frontmatter.category ?? frontmatter.categories).includes(needle);
}
function latestByCategory(key, n = 4) {
  return allPosts.filter(({ frontmatter }) => hasCat(frontmatter, key)).slice(0, n);
}

// category config
const CATS = [
  { key: 'nasa',          label: 'NASA YazÄ±larÄ±',             cta: 'YazÄ±yÄ± gÃ¶r â†’' },
  { key: 'reviews',       label: 'Ä°ncelemeler',               cta: 'Ä°ncelemeyi oku â†’' },
  { key: 'simulation',    label: 'SimÃ¼lasyonlar',             cta: 'SimÃ¼lasyona git â†’' },
  { key: 'informational', label: 'Bilgilendirici YazÄ±lar',    cta: 'Rehberi oku â†’' },
];

const latestNasa = allPosts.find(({ frontmatter }) => hasCat(frontmatter, 'nasa'));
---

<Layout title="Ana Sayfa">
  <section class="centered_flex home-main-section">
    <section class="hero centered_flex">
      <span class="hero-kicker">{site.name}</span>
      <h1 class="home-title">YÄ±ldÄ±zlar iÃ§in rehberin.</h1>
      <p class="home-description">
        SimÃ¼lasyonlar, kozmik sayfalar ve teleskop incelemeleri.
      </p>

      <div class="cta-row">
        <a
          href="/tr/telescopes"
          class="cta cta--primary"
          onclick="umami?.track?.('explore-telescopes-cta-tr')"
        >
          ğŸª TeleskoplarÄ± KeÅŸfet
        </a>
        <a
          href="/tr/top-telescopes"
          class="cta cta--dark"
          onclick="umami?.track?.('top-ten-cta-tr')"
        >
          â­ En Ä°yi 10 Teleskop
        </a>
        <a
          href="/tr/about"
          class="cta cta--ghost"
          onclick="umami?.track?.('about-cta-tr')"
        >
          â„¹ï¸ HakkÄ±mÄ±zda
        </a>
      </div>

      <div class="global-socials">
        <div class="global-socials-links">
          <a
            href="https://www.instagram.com/astrosyo_"
            target="_blank"
            rel="noopener noreferrer"
            class="social-link"
            aria-label="Instagram"
          >
            <Instagram size={42} />
          </a>
          <a
            href="https://www.youtube.com/@atakansaracyakupoglu9930"
            target="_blank"
            rel="noopener noreferrer"
            class="social-link"
            aria-label="YouTube"
          >
            <Youtube size={42} />
          </a>
          <a
            href="https://www.tiktok.com/@astrosyo?_r=1&_t=ZS-917RKCaEM"
            target="_blank"
            rel="noopener noreferrer"
            class="social-link"
            aria-label="TikTok"
          >
            <svg width="42" height="42" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M14.25 4.5c.45.87 1.23 1.59 2.19 2.04.46.22.97.35 1.48.38V9.4c-1.17-.05-2.3-.43-3.3-1.08v5.47c0 3.02-2.45 5.46-5.47 5.46S3.68 16.81 3.68 13.79c0-2.51 1.71-4.65 4.12-5.24.66-.16 1.34-.16 1.99-.04v2.51a2.7 2.7 0 0 0-.99-.19c-1.5 0-2.72 1.22-2.72 2.72s1.22 2.72 2.72 2.72 2.72-1.22 2.72-2.72V3h3.01c.08.52.26 1.02.52 1.5z" />
            </svg>
          </a>
        </div>
      </div>
    </section>

    <!-- Kategoriye gÃ¶re en son yazÄ±lar -->
    <section class="latest-section">
      {CATS.map((cat) => {
        const items = latestByCategory(cat.key, 4);
        if (items.length === 0) return null;

        return (
          <section class="category-section">
            <a href={`/tr/category/${cat.key.toLowerCase()}`} class="latest-link">
              <h2 class="latest-title">{cat.label} â†’</h2>
            </a>

            <div class="post-grid category-grid">
              {
                items.map(({ frontmatter, url }) => {
                  const isP5     = hasCat(frontmatter, 'simulation');
                  const isReview = hasCat(frontmatter, 'reviews');
                  const isInfo   = hasCat(frontmatter, 'informational');
                  const isNasa   = hasCat(frontmatter, 'nasa');
                  const isLatestNasa = isNasa && latestNasa && url === latestNasa.url;

                  const cardClasses = [
                    'post-card',
                    isP5 && 'post-card--p5',
                    isReview && 'post-card--review',
                    isInfo && 'post-card--info',
                    isNasa && 'post-card--nasa',
                  ].filter(Boolean).join(' ');

                  const ctaText =
                    isP5 ? 'SimÃ¼lasyona git â†’'
                  : isReview ? 'Ä°ncelemeyi oku â†’'
                  : isInfo ? 'Rehberi oku â†’'
                  : isNasa ? 'YazÄ±yÄ± gÃ¶r â†’'
                  : 'YazÄ±nÄ±n tamamÄ±nÄ± oku â†’';

                  return (
                    <div class={cardClasses}>
                      <a href={url} class="post-card-link">
                        <div class="post-card-title">{frontmatter.title}</div>
                        <div class="post-card-meta">
                          {new Date(frontmatter.pubDate).toLocaleDateString('tr-TR')}
                        </div>
                        <p class="post-card-desc">{frontmatter.description}</p>

                        <div class={`post-card-footer ${(isP5 || isReview || isInfo || isNasa) ? 'has-badge' : ''}`}>
                          <div class="post-card-badges">
                            {isP5 && <span class="p5-badge">SimÃ¼lasyon</span>}
                            {isReview && <span class="review-badge">Ä°nceleme</span>}
                            {isInfo && <span class="info-badge">Bilgi</span>}
                            {isNasa && <span class="nasa-badge">NASA</span>}
                          </div>
                          <div class="read-post">{ctaText}</div>
                        </div>
                      </a>
                    </div>
                  );
                })
              }
            </div>
            <span class="divider"></span>
          </section>
        );
      })}
    </section>

    <!-- Bildirim / aÃ§Ä±klama bloklarÄ± (TÃ¼rkÃ§e) -->
    <section class="home-notice home-notice-first">
      <h3 class="home-notice-title">Neden bize gÃ¼venebilirsiniz?</h3>
      <p class="home-notice-text">
        Astrosyo, yazÄ±lÄ±m ve astronomi alanÄ±nda uzman kiÅŸiler tarafÄ±ndan oluÅŸturulmuÅŸ bir astronomi blogudur.
        YazarlarÄ±mÄ±z <strong>Atakan SaraÃ§yakupoÄŸlu</strong> ve <strong>Zane Landers</strong>,
        teleskoplar ve gÃ¶zlem ekipmanlarÄ± hakkÄ±nda gÃ¼venilir Ã¼rÃ¼n iÃ§gÃ¶rÃ¼leri, genel bakÄ±ÅŸlar ve incelemeler sunarak
        gÃ¶kyÃ¼zÃ¼ gÃ¶zlemlerinizde daha bilinÃ§li seÃ§imler yapmanÄ±za yardÄ±mcÄ± olmayÄ± hedefler.
      </p>
    </section>

    <section class="home-notice">
      <h3 class="home-notice-title">Ä°Ã§erik TÃ¼rlerimiz</h3>
      <p class="home-notice-text">
        <strong>Ä°nceleme YazÄ±larÄ±</strong>, teleskoplar ve astronomi ekipmanlarÄ±nÄ± bizzat kullanarak yaptÄ±ÄŸÄ±mÄ±z
        deneyimlere ve doÄŸrudan testlere dayanÄ±r.
        <strong>Genel BakÄ±ÅŸ YazÄ±larÄ±</strong> ise derinlemesine araÅŸtÄ±rma, Ã¼retici verileri, astronomi topluluÄŸu geri
        bildirimleri ve gÃ¼venilir kaynaklardan alÄ±nan baÄŸÄ±msÄ±z test sonuÃ§larÄ±na dayanÄ±r.
        Her iki tÃ¼r de size aÃ§Ä±k, dÃ¼rÃ¼st ve gerÃ§ekten iÅŸinize yarayacak bilgiler sunmayÄ± amaÃ§lar.
      </p>
    </section>

    <section class="home-notice">
      <h3 class="home-notice-title">Puanlama Sistemimiz</h3>
      <p class="home-notice-text">
        Ä°nceleme yazÄ±larÄ±nda verdiÄŸimiz puanlar, doÄŸrudan kendi kullanÄ±m deneyimlerimiz ve uzman gÃ¶rÃ¼ÅŸÃ¼mÃ¼zÃ¼ yansÄ±tÄ±r.
        Genel bakÄ±ÅŸ yazÄ±larÄ±ndaki puanlar ise, saygÄ±n kaynaklardan ve doÄŸrulanmÄ±ÅŸ kullanÄ±cÄ± deneyimlerinden
        derlenen iÃ§gÃ¶rÃ¼lerin bir sonucudur.
      </p>
    </section>

    <section class="home-notice">
      <h3 class="home-notice-title">Nereden satÄ±n almalÄ±?</h3>
      <p class="home-notice-text">
        GÃ¼venli kargo ve iade sÃ¼reÃ§leri aÃ§Ä±sÄ±ndan ana satÄ±cÄ± olarak HighPointScientific'i tercih etmenizi Ã¶neririz.
        Amazon da bir seÃ§enek olmakla birlikte, zaman zaman eksik parÃ§alÄ± astronomi ekipmanlarÄ± gÃ¶nderildiÄŸi ve
        iade sÃ¼reÃ§lerinin daha karmaÅŸÄ±k olabildiÄŸi durumlarla karÅŸÄ±laÅŸÄ±labilmektedir.
      </p>
    </section>

    <section class="home-notice">
      <h3 class="home-notice-title">OrtaklÄ±k (Affiliate) Bildirimi</h3>
      <p class="home-notice-text">
        Amazon, HighPointScientific ve Astroshop ile ortaklÄ±k (affiliate) anlaÅŸmalarÄ±mÄ±z bulunmaktadÄ±r.
        Sitemizdeki bir baÄŸlantÄ±ya tÄ±klayÄ±p alÄ±ÅŸveriÅŸ yaptÄ±ÄŸÄ±nÄ±zda kÃ¼Ã§Ã¼k bir komisyon alabiliriz.
        Ancak iÃ§eriklerimiz tarafsÄ±z kalÄ±r â€” kÄ±sa vadeli affiliate gelirinden Ã§ok, sizin memnuniyetiniz ve
        uzun vadeli gÃ¼veniniz bizim iÃ§in daha Ã¶nemlidir.
      </p>
    </section>
  </section>
</Layout>
