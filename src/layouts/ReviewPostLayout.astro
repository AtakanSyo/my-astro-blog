---
import Layout from './Layout.astro';
import '../styles/postsGlobal.css';
import '../styles/reviewPost.css';  // ← pulls in your global styles
import SocialShare from '../components/SocialShare.astro';

const { url } = Astro.props;               // ← the page’s own URL

const {
  title,
  description,
  writer,
  pubDate,
  updatedDate,
  cover_image,
  rating = {}
} = Astro.props.frontmatter;

const ratingsArray = [
  { category: "Overall", value: rating.overall },
  { category: "Optics", value: rating.optics },
  { category: "Mount", value: rating.mount },
  { category: "Accessories", value: rating.accessories }
].filter(r => r.value !== undefined); // only include defined ratings

const jsonLdProduct = {
  "@context": "https://schema.org",
  "@type": "Product",
  "name": title,
  "description": description,
  "review": {
    "@type": "Review",
    "author": {
      "@type": "Person",
      "name": writer
    },
    "datePublished": pubDate,
    "dateModified": updatedDate || pubDate,
    "reviewBody": description,
    "reviewRating": ratingsArray.map(r => ({
      "@type": "Rating",
      "ratingValue": r.value,
      "bestRating": "10",
      "worstRating": "1",
      "name": r.category   // 🔑 label each rating
    }))
  }
};
---

<head>
  <title>{title}</title>
  <meta name="description" content={description} />
  <!-- JSON-LD markup for Google rich snippets -->
  <!-- Force‐inject raw JSON via set:html -->
  <script
    type="application/ld+json"
    set:html={JSON.stringify(jsonLdProduct, null, 2)}
  ></script>
  <link
    rel="preload"
    as="image"
    href={cover_image}
  />
</head>

<Layout title={title}>
  
  <article class="post centered_flex">
        <img
      src={cover_image}
      class="post-starter-image"
      alt={title + ' cover'}
      fetchpriority="high"
      loading="eager"       
      decoding="async"      
    />

    <h1>{title}</h1>
    <p class="writer">Written by {writer}</p>
    <div class="main-rating-card rating-card centered_flex"><span class="category">Overall</span><span class="score">{rating.overall}/10</span></div>
    <div class="share-header"><span class="share-label">Share:</span></div>
    <SocialShare frontmatter={Astro.props.frontmatter} url={url} client:load />
    <slot />

    
  </article>
</Layout>